# OpenSecKit V5 - RGS Tool Certification Schema
# Purpose: Define certification requirements for tools/services by RGS level

# ═══════════════════════════════════════════════════════════════════════════════
# CERTIFICATION TYPES
# ═══════════════════════════════════════════════════════════════════════════════

certification_types:
  # ANSSI Qualifications (French)
  secnumcloud:
    name: "SecNumCloud"
    authority: "ANSSI"
    description: "Cloud service security qualification"
    url: "https://cyber.gouv.fr/secnumcloud"
    validity_period: "3 years"
    levels: ["SecNumCloud 3.2"]

  cspn:
    name: "CSPN"
    authority: "ANSSI"
    description: "First Level Security Certification"
    url: "https://cyber.gouv.fr/produits-certifies-cspn"
    validity_period: "Varies"

  cc:
    name: "Common Criteria"
    authority: "ANSSI / International"
    description: "International security certification"
    url: "https://www.ssi.gouv.fr/entreprise/produits-certifies/"
    levels: ["EAL2", "EAL3", "EAL4", "EAL4+", "EAL5", "EAL6", "EAL7"]

  passi:
    name: "PASSI"
    authority: "ANSSI"
    description: "Security audit service provider qualification"
    url: "https://cyber.gouv.fr/prestataires-daudit"

  pris:
    name: "PRIS"
    authority: "ANSSI"
    description: "Incident response service provider qualification"
    url: "https://cyber.gouv.fr/prestataires-de-reponse-aux-incidents"

  # International Certifications
  iso27001:
    name: "ISO 27001"
    authority: "ISO / Accredited body"
    description: "Information Security Management System"
    validity_period: "3 years"

  soc2_type2:
    name: "SOC 2 Type II"
    authority: "AICPA"
    description: "Service Organization Controls"
    validity_period: "1 year"

  hds:
    name: "HDS"
    authority: "French Health Ministry"
    description: "Health Data Hosting certification"
    url: "https://esante.gouv.fr/labels-certifications/hds"
    validity_period: "3 years"

  pci_dss:
    name: "PCI-DSS"
    authority: "PCI SSC"
    description: "Payment Card Industry Data Security Standard"
    validity_period: "1 year"

# ═══════════════════════════════════════════════════════════════════════════════
# REQUIREMENTS BY RGS LEVEL
# ═══════════════════════════════════════════════════════════════════════════════

rgs_requirements:
  rgs-star:
    description: "Standard security level"
    cloud_hosting:
      required: []
      recommended: ["iso27001", "soc2_type2"]
      blockers: []
    identity_provider:
      required: []
      recommended: ["iso27001", "soc2_type2"]
    security_tools:
      required: []
      recommended: ["iso27001"]
    certificates:
      required: []
      recommended: ["RGS qualified"]

  rgs-star-star:
    description: "Enhanced security level"
    cloud_hosting:
      required: ["iso27001"]
      recommended: ["secnumcloud"]
      blockers:
        - condition: "stores_sensitive_data"
          requires: ["secnumcloud"]
          message: "SecNumCloud required for sensitive data storage"
    identity_provider:
      required: ["iso27001", "soc2_type2"]
      recommended: []
    security_tools:
      required: ["iso27001"]
      recommended: ["soc2_type2"]
    certificates:
      required: ["RGS qualified"]
      recommended: ["RGS** qualified"]

  rgs-star-star-star:
    description: "Maximum security level (OIV/Critical)"
    cloud_hosting:
      required: ["secnumcloud"]
      recommended: []
      blockers:
        - condition: "any_cloud_usage"
          requires: ["secnumcloud"]
          message: "SecNumCloud mandatory for all cloud services at RGS***"
    identity_provider:
      required: ["secnumcloud"]
      recommended: []
      alternatives:
        - "On-premise qualified solution"
    security_tools:
      required: ["anssi_qualified"]
      recommended: []
    certificates:
      required: ["RGS*** qualified", "ANSSI qualified TSP"]
    timestamping:
      required: ["ANSSI qualified TSA"]
    signature:
      required: ["ANSSI qualified"]

# ═══════════════════════════════════════════════════════════════════════════════
# TOOL CATEGORIES
# ═══════════════════════════════════════════════════════════════════════════════

tool_categories:
  cloud_hosting:
    name: "Cloud Hosting"
    description: "IaaS/PaaS providers"
    examples: ["AWS", "GCP", "Azure", "OVH", "Scaleway", "Outscale"]
    data_impact: "high"

  identity_provider:
    name: "Identity Provider"
    description: "Authentication and SSO services"
    examples: ["Auth0", "Okta", "Azure AD", "Keycloak"]
    data_impact: "high"

  ci_cd:
    name: "CI/CD Platform"
    description: "Continuous integration and deployment"
    examples: ["GitHub Actions", "GitLab CI", "Jenkins", "CircleCI"]
    data_impact: "medium"
    code_access: true

  source_control:
    name: "Source Control"
    description: "Code repository hosting"
    examples: ["GitHub", "GitLab", "Bitbucket", "Azure DevOps"]
    data_impact: "high"
    code_access: true

  secrets_management:
    name: "Secrets Management"
    description: "Secrets and credentials storage"
    examples: ["HashiCorp Vault", "AWS Secrets Manager", "Azure Key Vault"]
    data_impact: "critical"

  monitoring:
    name: "Monitoring & Observability"
    description: "APM, logging, alerting"
    examples: ["Datadog", "New Relic", "Splunk", "Elastic"]
    data_impact: "medium"
    may_contain_pii: true

  communication:
    name: "Communication"
    description: "Team messaging and collaboration"
    examples: ["Slack", "Teams", "Discord"]
    data_impact: "low"

  documentation:
    name: "Documentation"
    description: "Knowledge base and documentation"
    examples: ["Confluence", "Notion", "GitBook"]
    data_impact: "medium"

  project_management:
    name: "Project Management"
    description: "Issue tracking and project planning"
    examples: ["Jira", "Linear", "GitHub Issues", "Asana"]
    data_impact: "low"

  email:
    name: "Email Service"
    description: "Transactional and marketing email"
    examples: ["SendGrid", "Mailgun", "AWS SES", "Mailchimp"]
    data_impact: "medium"
    pii_processed: true

  payment:
    name: "Payment Processing"
    description: "Payment gateway and processing"
    examples: ["Stripe", "PayPal", "Adyen", "Mollie"]
    data_impact: "critical"
    pci_scope: true

  analytics:
    name: "Analytics"
    description: "Usage analytics and tracking"
    examples: ["Google Analytics", "Mixpanel", "Amplitude", "Matomo"]
    data_impact: "medium"
    may_contain_pii: true

  cdn:
    name: "CDN"
    description: "Content delivery network"
    examples: ["Cloudflare", "Fastly", "CloudFront", "Akamai"]
    data_impact: "low"

  dns:
    name: "DNS"
    description: "Domain name services"
    examples: ["Cloudflare", "Route53", "Google DNS"]
    data_impact: "low"

# ═══════════════════════════════════════════════════════════════════════════════
# KNOWN CERTIFICATIONS (Reference Data)
# ═══════════════════════════════════════════════════════════════════════════════

known_certifications:
  # SecNumCloud qualified (fetch live from ANSSI for current list)
  secnumcloud_qualified:
    - name: "OVHcloud"
      products: ["Hosted Private Cloud", "Public Cloud"]
      certificate_date: "2024"
    - name: "Outscale"
      products: ["Cloud Services"]
      certificate_date: "2023"
    - name: "3DS Outscale"
      products: ["IaaS"]
      certificate_date: "2023"
    # Note: This list is not exhaustive - fetch from ANSSI

  # Common certifications by provider
  providers:
    aws:
      certifications: ["iso27001", "soc2_type2", "pci_dss"]
      secnumcloud: false
      notes: "No SecNumCloud, consider for RGS* only"

    gcp:
      certifications: ["iso27001", "soc2_type2", "pci_dss"]
      secnumcloud: false
      notes: "No SecNumCloud, consider for RGS* only"

    azure:
      certifications: ["iso27001", "soc2_type2", "pci_dss"]
      secnumcloud: false
      notes: "No SecNumCloud, consider for RGS* only"

    ovhcloud:
      certifications: ["iso27001", "soc2_type2", "hds", "secnumcloud"]
      secnumcloud: true
      notes: "SecNumCloud qualified for specific products"

    scaleway:
      certifications: ["iso27001", "soc2_type2"]
      secnumcloud: false
      notes: "French provider, working toward SecNumCloud"

    github:
      certifications: ["soc2_type2", "iso27001"]
      notes: "SOC 2 Type II certified"

    gitlab:
      certifications: ["soc2_type2", "iso27001"]
      notes: "SOC 2 Type II certified, self-hosted option"

    datadog:
      certifications: ["soc2_type2", "iso27001"]
      notes: "SOC 2 Type II certified"

    auth0:
      certifications: ["soc2_type2", "iso27001"]
      notes: "SOC 2 Type II certified"

    okta:
      certifications: ["soc2_type2", "iso27001", "fedramp"]
      notes: "SOC 2 Type II, FedRAMP certified"

    stripe:
      certifications: ["pci_dss", "soc2_type2", "iso27001"]
      notes: "PCI DSS Level 1 Service Provider"

# ═══════════════════════════════════════════════════════════════════════════════
# ASSESSMENT SCHEMA
# ═══════════════════════════════════════════════════════════════════════════════

tool_assessment:
  # Schema for tool certification assessment result
  properties:
    tool_id:
      type: "string"
      description: "Unique identifier matching tooling.yaml"
    tool_name:
      type: "string"
    category:
      type: "string"
      enum: ["cloud_hosting", "identity_provider", "ci_cd", "source_control",
             "secrets_management", "monitoring", "communication", "documentation",
             "project_management", "email", "payment", "analytics", "cdn", "dns"]
    vendor:
      type: "string"
    certifications_claimed:
      type: "array"
      items:
        type: "object"
        properties:
          certification: { type: "string" }
          certificate_ref: { type: "string" }
          expiry_date: { type: "string", format: "date" }
          verified: { type: "boolean" }
    certifications_required:
      type: "array"
      items: { type: "string" }
    certifications_recommended:
      type: "array"
      items: { type: "string" }
    compliance_status:
      type: "string"
      enum: ["compliant", "partial", "non_compliant", "blocker"]
    is_blocker:
      type: "boolean"
      description: "True if missing certification blocks RGS level"
    blocker_message:
      type: "string"
    remediation:
      type: "object"
      properties:
        action: { type: "string" }
        alternatives:
          type: "array"
          items: { type: "string" }
        effort: { type: "string", enum: ["low", "medium", "high"] }
