# Security Test Plan: {{ feature_id }}

> Generated by `/osk-secure plan` on {{ created }}
> Feature: {{ feature_name }}

## Overview

| Attribute | Value |
|-----------|-------|
| **Feature** | {{ feature_name }} |
| **Tech Stack** | {{ tech_stack | default(value="Not specified") }} |
| **Risk Level** | {{ risk_level | default(value="Medium") }} |
| **Test Coverage Target** | {{ coverage_target | default(value="100%") }} |

---

## Test Categories

### 1. Static Application Security Testing (SAST)

**Tool**: {{ sast_tool | default(value="Semgrep / CodeQL") }}
**Trigger**: Every commit/PR

| Rule Category | Priority | Blocking |
|---------------|----------|----------|
{% for rule in sast_rules | default(value=[]) %}| {{ rule.category }} | {{ rule.priority }} | {{ rule.blocking }} |
{% else %}| Injection (SQLi, XSS, Command) | HIGH | Yes |
| Authentication flaws | HIGH | Yes |
| Cryptographic issues | HIGH | Yes |
| Hardcoded secrets | CRITICAL | Yes |
| Insecure deserialization | MEDIUM | No |
{% endfor %}

**Configuration**:
```yaml
# .semgrep.yml or equivalent
rules:
  - p/security-audit
  - p/owasp-top-ten
  - p/secrets
```

---

### 2. Dynamic Application Security Testing (DAST)

**Tool**: {{ dast_tool | default(value="OWASP ZAP") }}
**Trigger**: Post-deployment to staging

| Scan Type | Scope | Frequency |
|-----------|-------|-----------|
| Baseline | All endpoints | Every deploy |
| Full scan | Critical paths | Weekly |
| API scan | REST/GraphQL | Every deploy |

**Target Endpoints**:
{% for endpoint in endpoints | default(value=[]) %}
- `{{ endpoint.method }} {{ endpoint.path }}` - {{ endpoint.auth_level }}
{% else %}
- All endpoints defined in security-spec.md
{% endfor %}

**Expected Findings to Block Release**:
- SQL Injection
- XSS (Reflected, Stored)
- CSRF on state-changing operations
- Authentication bypass
- Sensitive data exposure

---

### 3. Software Composition Analysis (SCA)

**Tool**: {{ sca_tool | default(value="npm audit / pip-audit / cargo audit") }}
**Trigger**: Daily + PR checks

| Severity | Action | SLA |
|----------|--------|-----|
| CRITICAL | Block PR/Release | 48h |
| HIGH | Block PR/Release | 7d |
| MEDIUM | Warning | 30d |
| LOW | Info | Backlog |

**Monitored Dependencies**:
{% for dep in dependencies | default(value=[]) %}
- `{{ dep.name }}@{{ dep.version }}` - {{ dep.risk }}
{% else %}
- All production dependencies
- All dev dependencies with build impact
{% endfor %}

---

### 4. Security Regression Tests

**Framework**: {{ test_framework | default(value="Jest / Pytest / Go test") }}
**Trigger**: Every PR + nightly

#### Authentication Tests

| Test Case | Description | Expected |
|-----------|-------------|----------|
{% for test in auth_tests | default(value=[]) %}| {{ test.id }} | {{ test.description }} | {{ test.expected }} |
{% else %}| AUTH-001 | Invalid credentials rejected | 401 Unauthorized |
| AUTH-002 | Expired token rejected | 401 Unauthorized |
| AUTH-003 | Missing token rejected | 401 Unauthorized |
| AUTH-004 | Brute force protection triggers | 429 after 5 attempts |
| AUTH-005 | Session invalidated on logout | Token unusable |
{% endfor %}

#### Authorization Tests

| Test Case | Description | Expected |
|-----------|-------------|----------|
{% for test in authz_tests | default(value=[]) %}| {{ test.id }} | {{ test.description }} | {{ test.expected }} |
{% else %}| AUTHZ-001 | User cannot access other user's data | 403 Forbidden |
| AUTHZ-002 | Non-admin cannot access admin endpoints | 403 Forbidden |
| AUTHZ-003 | Deleted user cannot authenticate | 401 Unauthorized |
| AUTHZ-004 | Role downgrade removes permissions | Access denied |
{% endfor %}

#### Input Validation Tests

| Test Case | Description | Expected |
|-----------|-------------|----------|
{% for test in validation_tests | default(value=[]) %}| {{ test.id }} | {{ test.description }} | {{ test.expected }} |
{% else %}| VAL-001 | SQL injection payload rejected | 400 Bad Request |
| VAL-002 | XSS payload sanitized | Escaped output |
| VAL-003 | Oversized input rejected | 413 Payload Too Large |
| VAL-004 | Invalid JSON rejected | 400 Bad Request |
| VAL-005 | Path traversal blocked | 400 Bad Request |
{% endfor %}

#### Cryptography Tests

| Test Case | Description | Expected |
|-----------|-------------|----------|
{% for test in crypto_tests | default(value=[]) %}| {{ test.id }} | {{ test.description }} | {{ test.expected }} |
{% else %}| CRYPTO-001 | TLS 1.2+ enforced | Connection refused on TLS 1.1 |
| CRYPTO-002 | Weak ciphers rejected | Connection refused |
| CRYPTO-003 | Passwords hashed with bcrypt/argon2 | Hash format verified |
| CRYPTO-004 | Sensitive data encrypted at rest | Ciphertext verified |
{% endfor %}

---

## CI/CD Integration

### GitHub Actions Example

```yaml
name: Security Tests
on: [push, pull_request]

jobs:
  sast:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run SAST
        uses: returntocorp/semgrep-action@v1
        with:
          config: p/security-audit p/owasp-top-ten

  sca:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run SCA
        run: |
          npm audit --audit-level=high
          # or: pip-audit, cargo audit, etc.

  security-regression:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run Security Tests
        run: npm test -- --grep "security"

  dast:
    runs-on: ubuntu-latest
    needs: [deploy-staging]
    if: github.ref == 'refs/heads/main'
    steps:
      - name: Run ZAP Scan
        uses: zaproxy/action-full-scan@v0.8.0
        with:
          target: {% raw %}'${{ secrets.STAGING_URL }}'{% endraw %}
```

---

## Verification Checklist

### Pre-Release

- [ ] SAST scan passed (0 CRITICAL/HIGH)
- [ ] SCA scan passed (0 CRITICAL/HIGH vulnerabilities)
- [ ] All authentication tests passing
- [ ] All authorization tests passing
- [ ] All input validation tests passing
- [ ] DAST baseline scan completed

### Release Gate

- [ ] No blocking findings in any security test
- [ ] Security regression test suite green
- [ ] Manual review of any new warnings
- [ ] Risk register updated with test results

---

## Linked Requirements

{% for req in linked_requirements | default(value=[]) %}
- `{{ req.id }}`: {{ req.description }} â†’ Test: {{ req.test_id }}
{% else %}
See `security-spec.md` for full requirements traceability.
{% endfor %}

---

## Metrics

| Metric | Target | Current |
|--------|--------|---------|
| SAST Coverage | 100% | {{ sast_coverage | default(value="TBD") }} |
| Security Test Count | {{ target_test_count | default(value="20+") }} | {{ current_test_count | default(value="TBD") }} |
| False Positive Rate | < 10% | {{ false_positive_rate | default(value="TBD") }} |
| Mean Time to Remediate | < SLA | {{ mttr | default(value="TBD") }} |
