# OpenSecKit - Secure Defaults Library
# Use: Default security configurations for common scenarios

metadata:
  library_id: "secure-defaults"
  name: "Secure Default Configurations"

defaults:
  # Authentication Defaults
  authentication:
    password_policy:
      min_length: 12
      max_length: 128
      require_uppercase: false  # NIST recommends no complexity requirements
      require_lowercase: false
      require_numbers: false
      require_special: false
      check_breach_database: true
      check_common_passwords: true
      common_password_list_size: 10000

    session:
      idle_timeout_minutes: 15
      absolute_timeout_hours: 8
      regenerate_on_login: true
      regenerate_on_privilege_change: true

    cookies:
      secure: true
      http_only: true
      same_site: "strict"
      path: "/"
      domain: "explicit"

    jwt:
      algorithm: "RS256"
      access_token_expiry_minutes: 15
      refresh_token_expiry_days: 7
      issuer: "explicit"
      audience: "explicit"
      clock_tolerance_seconds: 30

    rate_limiting:
      login:
        requests_per_minute: 5
        lockout_after_failures: 10
        lockout_duration_minutes: 30
      password_reset:
        requests_per_hour: 3
        requests_per_day: 10
      api:
        requests_per_minute: 60
        requests_per_hour: 1000

    mfa:
      required_for: ["admin", "privileged_operations"]
      totp_algorithm: "SHA1"
      totp_digits: 6
      totp_period_seconds: 30
      backup_codes_count: 10
      remember_device_days: 30

  # Authorization Defaults
  authorization:
    model: "rbac"  # rbac, abac, or hybrid

    default_permissions:
      authenticated: ["read_own"]
      admin: ["*"]

    object_level:
      always_check_ownership: true
      deny_by_default: true

    api:
      require_authentication_by_default: true
      log_authorization_failures: true

  # Input Validation Defaults
  validation:
    strings:
      max_length: 10000
      encoding: "utf-8"
      strip_null_bytes: true
      normalize_unicode: true

    numbers:
      allow_leading_zeros: false
      max_integer: 9007199254740991  # JS safe integer

    files:
      max_size_mb: 10
      allowed_types: "whitelist"
      scan_for_malware: true
      rename_on_upload: true
      store_outside_webroot: true

    html:
      sanitizer: "DOMPurify"
      allow_safe_tags: true
      strip_dangerous_protocols: true

  # Cryptography Defaults
  cryptography:
    tls:
      min_version: "1.2"
      recommended_version: "1.3"
      hsts_max_age_seconds: 31536000
      hsts_include_subdomains: true
      hsts_preload: true

    symmetric:
      algorithm: "AES-256-GCM"
      key_derivation: "Argon2id"
      key_rotation_days: 90

    hashing:
      passwords: "Argon2id"
      argon2_memory_kb: 65536
      argon2_iterations: 3
      argon2_parallelism: 4

    signatures:
      algorithm: "ECDSA-P256"
      fallback: "RSA-2048"

  # Logging Defaults
  logging:
    security_events:
      log_authentication_success: true
      log_authentication_failure: true
      log_authorization_failure: true
      log_data_access: true
      log_data_modification: true
      log_admin_actions: true
      log_configuration_changes: true

    pii_handling:
      mask_email: true
      mask_phone: true
      mask_ip: "partial"  # partial, full, none
      never_log_passwords: true
      never_log_tokens: true

    retention:
      security_logs_days: 365
      application_logs_days: 90
      debug_logs_days: 7

    format:
      structured: true
      format: "json"
      include_timestamp: true
      include_request_id: true
      include_user_id: true

  # Error Handling Defaults
  errors:
    production:
      show_stack_traces: false
      show_internal_errors: false
      generic_error_message: "An error occurred. Please try again."
      log_all_errors: true

    development:
      show_stack_traces: true
      show_internal_errors: true

    authentication_errors:
      generic_message: "Invalid credentials"
      no_user_enumeration: true

  # CORS Defaults
  cors:
    allow_credentials: false
    allowed_origins: "explicit_whitelist"
    allowed_methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
    allowed_headers: ["Content-Type", "Authorization"]
    expose_headers: []
    max_age_seconds: 86400

  # Security Headers Defaults
  headers:
    content_security_policy: "default-src 'self'"
    x_content_type_options: "nosniff"
    x_frame_options: "DENY"
    x_xss_protection: "0"  # Deprecated, use CSP
    referrer_policy: "strict-origin-when-cross-origin"
    permissions_policy: "geolocation=(), camera=(), microphone=()"

  # Database Defaults
  database:
    connections:
      use_ssl: true
      connection_pooling: true
      max_connections: 20
      idle_timeout_seconds: 300

    queries:
      parameterized_only: true
      query_timeout_seconds: 30
      log_slow_queries: true
      slow_query_threshold_ms: 1000

    credentials:
      principle_of_least_privilege: true
      separate_read_write_accounts: true
      no_hardcoded_credentials: true

  # Dependencies Defaults
  dependencies:
    scanning:
      scan_frequency: "daily"
      block_critical_vulnerabilities: true
      block_high_vulnerabilities: true
      cvss_threshold: 7.0

    updates:
      auto_update_patch: true
      auto_update_minor: false
      auto_update_major: false
      review_before_update: true

    lockfile:
      require_lockfile: true
      integrity_check: true
